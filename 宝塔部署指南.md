# 宝塔Linux面板部署指南 🎯

## 一、准备工作

### 1.1 服务器要求
- **操作系统**: CentOS 7+ / Ubuntu 16+ / Debian 9+
- **内存**: 至少 512MB（推荐 1GB+）
- **磁盘**: 至少 10GB 可用空间
- **宝塔面板**: 7.0+ 版本

---

## 二、安装宝塔面板

### 2.1 连接服务器

使用SSH工具连接服务器（如：PuTTY、XShell、FinalShell）

```bash
ssh root@你的服务器IP
```

### 2.2 一键安装宝塔面板

#### CentOS系统：
```bash
yum install -y wget && wget -O install.sh https://download.bt.cn/install/install_6.0.sh && sh install.sh ed8484bec
```

#### Ubuntu/Debian系统：
```bash
wget -O install.sh https://download.bt.cn/install/install-ubuntu_6.0.sh && sudo bash install.sh ed8484bec
```

安装完成后会显示：
```
外网面板地址: http://你的IP:8888/xxxxxxxx
内网面板地址: http://内网IP:8888/xxxxxxxx
username: xxxxxxxx
password: xxxxxxxx
```

**⚠️ 重要：请保存好这些信息！**

---

## 三、宝塔面板初始化配置

### 3.1 登录宝塔面板

1. 打开浏览器，访问：`http://你的服务器IP:8888/xxxxxxxx`
2. 输入用户名和密码登录

### 3.2 安装软件环境

首次登录会弹出推荐安装套件，选择以下软件：

✅ **必须安装：**
- **Nginx** 1.20+ （选择编译安装，更稳定）
- **PM2管理器** 最新版本

✅ **可选安装：**
- **phpMyAdmin** （如果需要数据库管理界面）

**注意：** 不需要安装 MySQL 和 PHP，因为我们的项目使用 SQLite 数据库。

点击"一键安装"，等待安装完成（约5-15分钟）。

---

## 四、上传项目文件

### 方法1：通过宝塔文件管理器上传（推荐）

1. 在宝塔面板点击左侧 **"文件"**
2. 进入目录：`/www/wwwroot/`
3. 点击 **"上传"** 按钮
4. 选择你的项目压缩包（建议先将项目打包成 `.zip` 或 `.tar.gz`）
5. 上传完成后，右键点击压缩包，选择 **"解压"**

### 方法2：通过Git克隆（如果项目在GitHub）

1. 在宝塔面板点击 **"终端"**
2. 输入命令：
```bash
cd /www/wwwroot/
git clone https://github.com/siuserxy-cmd/project-management.git
```

### 方法3：使用FTP工具上传

1. 在宝塔面板创建FTP账号
2. 使用 FileZilla 或其他FTP工具连接
3. 上传项目文件到 `/www/wwwroot/project-management/`

---

## 五、配置Node.js项目

### 5.1 安装项目依赖

1. 点击左侧 **"软件商店"**
2. 找到 **"PM2管理器"**，点击 **"设置"**
3. 或者点击左侧 **"终端"**，进入项目目录：

```bash
cd /www/wwwroot/project-management
npm install
```

### 5.2 初始化数据库

```bash
cd /www/wwwroot/project-management
npm run init-db
```

或者：
```bash
node scripts/init-db.js
```

### 5.3 使用PM2启动项目

#### 方法1：通过PM2管理器界面（推荐）

1. 点击左侧 **"软件商店"**
2. 找到 **"PM2管理器"**，点击 **"设置"**
3. 点击 **"添加项目"**
4. 填写信息：
   - **项目名称**: `项目管理系统`
   - **项目路径**: `/www/wwwroot/project-management`
   - **启动文件**: `server.js`
   - **端口**: `3001`
5. 点击 **"提交"**

#### 方法2：通过命令行

```bash
cd /www/wwwroot/project-management
pm2 start server.js --name "项目管理系统"
pm2 save
pm2 startup
```

### 5.4 检查运行状态

```bash
pm2 status
pm2 logs 项目管理系统
```

---

## 六、配置Nginx反向代理

### 6.1 创建网站

1. 点击左侧 **"网站"**
2. 点击 **"添加站点"**
3. 填写信息：
   - **域名**: `yourdomain.com`（如果没有域名，可以填写服务器IP）
   - **根目录**: `/www/wwwroot/project-management/public`
   - **PHP版本**: 纯静态
   - **FTP**: 不创建
   - **数据库**: 不创建
4. 点击 **"提交"**

### 6.2 配置反向代理

1. 在网站列表中，找到刚创建的网站
2. 点击 **"设置"**
3. 点击左侧 **"反向代理"**
4. 点击 **"添加反向代理"**
5. 填写信息：
   - **代理名称**: `项目管理`
   - **目标URL**: `http://127.0.0.1:3001`
   - **发送域名**: `$host`
6. 点击 **"提交"**

### 6.3 配置示例（如果需要手动修改）

Nginx配置会自动生成，如果需要手动调整，配置内容如下：

```nginx
location / {
    proxy_pass http://127.0.0.1:3001;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
}
```

---

## 七、配置防火墙和安全组

### 7.1 宝塔面板防火墙

1. 点击左侧 **"安全"**
2. 确保开放以下端口：
   - `8888` - 宝塔面板
   - `80` - HTTP
   - `443` - HTTPS（如果配置了SSL）
   - `22` - SSH
   - ~~`3001`~~ - **不要**对外开放（通过Nginx代理访问）

### 7.2 云服务器安全组

在你的云服务商控制台（腾讯云/阿里云等）配置安全组规则：
- 开放端口：`22`, `80`, `443`, `8888`
- 来源：`0.0.0.0/0`

---

## 八、配置SSL证书（HTTPS）

### 8.1 申请免费SSL证书

1. 在网站设置中，点击 **"SSL"**
2. 选择 **"Let's Encrypt"** 免费证书
3. 输入你的邮箱
4. 勾选你的域名
5. 点击 **"申请"**

### 8.2 强制HTTPS

证书申请成功后：
1. 勾选 **"强制HTTPS"**
2. 浏览器访问会自动跳转到HTTPS

---

## 九、项目管理和维护

### 9.1 启动/停止/重启项目

通过宝塔PM2管理器界面：
1. 点击 **"软件商店"** → **"PM2管理器"** → **"设置"**
2. 在项目列表中，点击对应按钮：
   - 🟢 **启动**
   - 🔴 **停止**
   - 🔄 **重启**

或通过命令行：
```bash
pm2 restart 项目管理系统
pm2 stop 项目管理系统
pm2 start 项目管理系统
```

### 9.2 查看日志

通过PM2管理器界面：
- 点击项目的 **"日志"** 按钮

或通过命令行：
```bash
pm2 logs 项目管理系统
pm2 logs 项目管理系统 --lines 100
```

### 9.3 更新项目代码

如果使用Git：
```bash
cd /www/wwwroot/project-management
git pull
npm install
pm2 restart 项目管理系统
```

如果手动上传：
1. 通过宝塔文件管理器上传新文件
2. 覆盖旧文件
3. 在PM2管理器中重启项目

---

## 十、数据备份

### 10.1 使用宝塔计划任务

1. 点击左侧 **"计划任务"**
2. 点击 **"添加计划任务"**
3. 配置备份任务：

#### 备份数据库：
```bash
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
mkdir -p /www/backup/database/
cp /www/wwwroot/project-management/database.db /www/backup/database/database_$DATE.db
# 删除7天前的备份
find /www/backup/database/ -name "*.db" -mtime +7 -delete
```

#### 备份上传文件：
```bash
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
mkdir -p /www/backup/uploads/
tar -czf /www/backup/uploads/uploads_$DATE.tar.gz /www/wwwroot/project-management/uploads
# 删除7天前的备份
find /www/backup/uploads/ -name "*.tar.gz" -mtime +7 -delete
```

设置任务：
- **任务类型**: Shell脚本
- **任务名称**: 备份项目数据库
- **执行周期**: 每天凌晨2点
- **脚本内容**: 粘贴上面的脚本

---

## 十一、性能优化

### 11.1 开启Gzip压缩

1. 网站设置 → **"配置文件"**
2. 找到 `gzip` 相关配置，确保开启：
```nginx
gzip on;
gzip_min_length  1k;
gzip_buffers     4 16k;
gzip_comp_level 5;
gzip_types       text/plain application/javascript text/css application/xml text/javascript;
```

### 11.2 配置静态文件缓存

在网站设置 → **"配置文件"** 中添加：
```nginx
location ~* \.(jpg|jpeg|png|gif|ico|css|js)$ {
    expires 7d;
    access_log off;
}
```

---

## 十二、常见问题解决

### 12.1 端口被占用

```bash
# 查看端口占用
netstat -tlnp | grep 3001
# 或使用宝塔命令
bt
```

### 12.2 PM2项目无法启动

1. 查看日志：`pm2 logs 项目管理系统`
2. 检查端口是否被占用
3. 检查 `node_modules` 是否完整：重新运行 `npm install`

### 12.3 无法访问网站

1. 检查Nginx状态：宝塔面板 → **"软件商店"** → **"Nginx"** → 查看状态
2. 检查防火墙：宝塔面板 → **"安全"**
3. 检查域名解析：`ping 你的域名`
4. 查看Nginx错误日志：网站设置 → **"日志"**

### 12.4 上传文件失败

1. 检查 `uploads` 目录权限：
```bash
chmod 755 /www/wwwroot/project-management/uploads
```

2. 检查宝塔上传限制：
   - 宝塔面板 → **"软件商店"** → **"Nginx"** → **"配置修改"**
   - 找到 `client_max_body_size`，改为 `50M` 或更大

---

## 十三、访问项目

### 13.1 通过IP访问
```
http://你的服务器IP
```

### 13.2 通过域名访问
```
http://yourdomain.com
或
https://yourdomain.com (配置SSL后)
```

### 13.3 默认登录信息
- 超级管理员：`superadmin` / `123456`
- 管理员1：`admin1` / `123456`

**⚠️ 重要：登录后请立即修改密码！**

---

## 十四、宝塔面板优势

使用宝塔面板部署的优势：

✅ **可视化操作** - 无需记忆命令
✅ **一键安装** - 软件环境快速部署
✅ **文件管理** - 方便上传和管理文件
✅ **进程监控** - 实时查看项目运行状态
✅ **自动备份** - 计划任务自动备份
✅ **安全防护** - 内置防火墙和安全策略
✅ **SSL证书** - 一键申请免费证书
✅ **日志查看** - 方便排查问题

---

## 🎉 部署完成！

完成以上步骤后，你的项目就可以通过域名或IP地址访问了！

**检查清单：**
- [ ] 宝塔面板安装成功
- [ ] PM2管理器已安装
- [ ] 项目文件已上传
- [ ] 数据库已初始化
- [ ] PM2启动项目成功
- [ ] Nginx反向代理配置完成
- [ ] 防火墙端口已开放
- [ ] 可以正常访问网站
- [ ] SSL证书已配置（可选）

**需要帮助？**
- 宝塔面板论坛：https://www.bt.cn/bbs/
- 宝塔官方文档：https://www.bt.cn/docs/

---

## 附录：快速命令参考

```bash
# 查看PM2进程
pm2 list

# 重启项目
pm2 restart 项目管理系统

# 查看日志
pm2 logs 项目管理系统

# 进入项目目录
cd /www/wwwroot/project-management

# 更新代码（Git方式）
git pull && npm install && pm2 restart 项目管理系统

# 查看端口占用
netstat -tlnp | grep 3001

# 重启Nginx
nginx -t && nginx -s reload
```
