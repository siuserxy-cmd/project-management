<!DOCTYPE html>
<html>
<head>
    <title>æµ‹è¯•æ–‡ä»¶ä¸Šä¼ </title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-md mx-auto bg-white rounded-lg shadow p-6">
        <h1 class="text-xl font-bold mb-4">æµ‹è¯•æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½</h1>

        <div class="mb-4">
            <label class="block text-sm font-medium mb-2">é€‰æ‹©æ–‡ä»¶ï¼š</label>
            <input type="file" id="fileInput" multiple accept=".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png,.gif" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
        </div>

        <div class="mb-4">
            <label class="block text-sm font-medium mb-2">ç²˜è´´æµ‹è¯•åŒºåŸŸï¼š</label>
            <textarea id="pasteArea" placeholder="åœ¨è¿™é‡Œç²˜è´´å›¾ç‰‡è¯•è¯• (Ctrl+V)" class="w-full p-3 border rounded-lg h-24"></textarea>
        </div>

        <button onclick="testUpload()" class="w-full bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600">
            æµ‹è¯•ä¸Šä¼ 
        </button>

        <div id="result" class="mt-4"></div>
    </div>

    <script>
        let selectedFiles = [];

        document.getElementById('fileInput').addEventListener('change', function(e) {
            selectedFiles = Array.from(e.target.files);
            updateFileList();
        });

        document.getElementById('pasteArea').addEventListener('paste', function(e) {
            const items = e.clipboardData.items;

            for (let i = 0; i < items.length; i++) {
                const item = items[i];
                if (item.type.indexOf('image') !== -1) {
                    const file = item.getAsFile();
                    selectedFiles.push(file);
                    updateFileList();

                    const currentValue = this.value;
                    this.value = currentValue + (currentValue ? '\n' : '') + `ğŸ“· å·²æ·»åŠ å›¾ç‰‡: ${file.name}`;
                }
            }
        });

        function updateFileList() {
            const result = document.getElementById('result');
            if (selectedFiles.length > 0) {
                result.innerHTML = `
                    <h3 class="font-semibold mb-2">å·²é€‰æ‹©çš„æ–‡ä»¶ï¼š</h3>
                    <ul class="text-sm space-y-1">
                        ${selectedFiles.map(file => `
                            <li class="flex justify-between">
                                <span>${file.name}</span>
                                <span class="text-gray-500">${formatFileSize(file.size)}</span>
                            </li>
                        `).join('')}
                    </ul>
                `;
            }
        }

        async function testUpload() {
            if (selectedFiles.length === 0) {
                alert('è¯·å…ˆé€‰æ‹©æ–‡ä»¶');
                return;
            }

            const formData = new FormData();
            selectedFiles.forEach(file => {
                formData.append('files', file);
            });

            try {
                const response = await fetch('/api/upload', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (response.ok) {
                    document.getElementById('result').innerHTML = `
                        <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded">
                            <h3 class="font-semibold">ä¸Šä¼ æˆåŠŸï¼</h3>
                            <pre class="text-sm mt-2">${JSON.stringify(result, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    document.getElementById('result').innerHTML = `
                        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                            <h3 class="font-semibold">ä¸Šä¼ å¤±è´¥ï¼š</h3>
                            <p class="text-sm">${result.error}</p>
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('result').innerHTML = `
                    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                        <h3 class="font-semibold">ç½‘ç»œé”™è¯¯ï¼š</h3>
                        <p class="text-sm">${error.message}</p>
                    </div>
                `;
            }
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
    </script>
</body>
</html>